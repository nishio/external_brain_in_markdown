
hatena

```
<body>
*1377333960*リスコフの置換原則
拙著「<a href="http://www.amazon.co.jp/gp/product/477415654X/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=477415654X&linkCode=as2&tag=nishiohirokaz-22">コーディングを支える技術</a>」のp.216では、リスコフの置換原則について説明しています。しかし、p.217の「条件qを満たさないTが発生する」という表現はわかりにくいようですので、ここでストーリー仕立てにして補足説明をします

** 今日

まず、現時点でT型の値はすべて条件qを満たしているとします。

あなたはT型の引数をとる関数fを実装したいとします。あなたはきっと「T型の値はすべて条件qを満たしている」ということを前提としてコードを書くことでしょう。

** 1ヶ月後

あなたはSを作ろうと考えます。S型の値の中には条件qを満たさないものもありますが、あなたはあまり意識していません。

あなたは「SはTを継承して作ると楽だな」と思ったので、そうしました。

Javaなどの言語処理系では、SがTを継承すると、T型の変数にS型の値を入れることができるようになります。つまりこの時点でT型の引数を取る関数fにS型の値を渡すことも可能になっています。

** さらに1ヶ月後

あなたが2ヶ月前に実装した「T型の値を引数にとる関数f」の中で問題が起きます。

T型の値はすべて条件qを満たすはずなのに、条件qが満たされているなら起こりえないようなことが起こっています。あなたは悩みます。

あなたは原因が条件qを満たさないS型の値が引数に渡されていることだと気づきました。そこでif文で分岐して2通りの処理を書くことにしました。

これでよいのでしょうか？いや、違いますね。この2ヶ月の間に書かれた他のT型の値を扱うコードも、条件qを満たさない値だと問題が起きるかもしれません。この種のバグは、1匹目を見つけた頃には既に何十匹も物陰に潜んでいるのです。

あなたが次々出てくるバグに悩まされて、別の人に相談します。そして「なんでSはTを継承したんだ」と指摘されたとしましょう。でも、こういう状況って既にSを書きなおすことができない状況になっていたりするわけです。

** さいごに

このエントリーではリスコフの指摘した「置換原則を満たしていない場合に起こる問題」を、時系列に並べて解説してみました。書籍の方は紙面の制約がありますが、なんとかわかりやすくなるように修正したいと思います。

拙著「<a href="http://www.amazon.co.jp/gp/product/477415654X/ref=as_li_ss_tl?ie=UTF8&camp=247&creative=7399&creativeASIN=477415654X&linkCode=as2&tag=nishiohirokaz-22">コーディングを支える技術</a>」の読者のみなさんから頂いたご質問・ご感想には、このような感じで補足記事を書いて行きたいと思っています。おきがねなくご質問・ご感想をお寄せ下さい。

拙著に関する他のエントリーは「<a href='http://nhiro.org/langbook/'>「コーディングを支える技術」著者公式ページ</a>」からたどれるようにします。
<iframe src="http://rcm-jp.amazon.co.jp/e/cm?lt1=_blank&bc1=000000&IS2=1&bg1=AAFFAA&fc1=000000&lc1=0000FF&t=nishiohirokaz-22&o=9&p=8&l=as4&m=amazon&f=ifr&ref=ss_til&asins=477415654X" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</body>
<comments>
<comment>
<username>問い合わせした者</username>
<body>先日、この件について問い合わせした者です。<br><br>p.217の図12.5 右側の図にて、S型の値が条件qからはみ出していて、T型の値は条件qからはみ出していなかったので、p.217の６～７行目の「条件qを満たさないT」は、「条件qを満たさないS」ではないか？と早とちりしてしまいました！<br><br>整理するつもりで自分の言葉で表してみます。<br>条件qを満たさないS型のオブジェクトを、T型のクラスに代入したことにより「条件qを満たさないT」が生まれてしまった、ということですよね？<br><br>間違いではなかったのですね・・自分の勘違いしていた所に気づけました！<br>お騒がせしてすみません＞＜<br>ありがとうございました！</body>
<timestamp>1377345436</timestamp>
</comment>
<comment>
<username>nishiohirokazu</username>
<body>お役に立てたようで幸いです！<br>こういう質問をいただけると、説明のわかりにくい場所がどこか明確になるので助かります。<br>今後ともぜひよろしくお願いします！</body>
<timestamp>1377786055</timestamp>
</comment>
</comments>
```


[はてなダイアリー 2013-08-24](https://nishiohirokazu.hatenadiary.org/archive/2013/08/24)