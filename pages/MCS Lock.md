---
title: "MCS Lock"
---

- スタベーションフリー
    - 有限ステップ後には確実に実行される
    - ＝「運が悪いと無限に待たされる」ではない
- 待つ人はNodeを持っている
    - next: Node*
    - wait: boolean
- 「列の末尾」を指すポインタtailがある、最初はnull
- 列に並びたい人はtailと自分のノードへのポインタをアトミックにスワップする
    - スワップした結果がnullなら自分が列の先頭であることがわかる
        - ロックが取れた
        - 処理をする
    - not nullなら自分の前に並んでいる人がわかるので、その人の.nextを自分へのポインタにする
    - waitの値がfalseになるまで待つ
- 処理が終わった人はnextがnullでないならnext.waitをfalseにする



