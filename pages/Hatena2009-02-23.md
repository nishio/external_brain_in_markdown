---
title: "Hatena2009-02-23"
---

hatena

```
<body>
*1235335622*家事日記
トンネルを抜けると朝の5時半だった。

- □ 引っ越しの見積もりを比較する

コンビニ引越
>>
フリープラン引越料金 12,300円（消費税・保険料・高速料金等全て込みの確定料金）
使用車両・作業人数   1トン1名
全自動洗濯機の取り外し、取り付け、タンスの裏のホコリ落し、家具の分解組立、照明器具の取り付け、取り外し等は無料で行います。
<<

ハート引っ越し
>>
基本作業料金　　12,650円 ～　　【 近距離フリー便 】     作業員　２名
荷造資材料金　　　　サービス　
ダンボール　１０枚
ガムテープ　１本
布団袋　１袋
ハンガーＢＯＸ(レンタル）
リサイクルダンボール
<<

ダック引っ越し
>>
23000円
<<

サンタ引っ越し
>>
21000円
2トントラック、積載量25%程度
<<

ハート引っ越しセンターに決めようっと。


暗いと思ったら雨か。自転車で運べないなぁ。


避難はしごの点検の人が来た。すっかり忘れていた。


自転車に本を積めたキャリーバッグを積んで、いざ発進してみるとすぐ落ちる。どう積めばいいんだ。
<a href='http://www.komeri.com/howto/html/00320.html'>コメリ・ドットコム｜HowTo情報：ロープの結び方 自転車の荷台に荷物を積む</a>を読む。こんな結び方、100円ショップで買った2mのゴムひもでは無理だ！だまされた！10メートルのロープをがらくた箱から発掘したのでこれで再挑戦だ！


10メートル走って交差点の真ん中で落として大変なことになった。


ガスは開通するまでに時間がかかるので早めに連絡する必要がある。ガス、電気、水道の連絡先は大概不動産屋がつけてくれている。住所、名前、電話番号、立ち会いの日、つなぐガス器具などを聞かれる。東京ガスはガス停止も一緒にできる。名義に変更がなければカード払いを継続できるとのことなのでそうした。


水道。明日open, 立ち会いは必要なし。水が出なかったら元栓を開ける。クレジット引き落としにした。クレジットの申し込みが終わるまで今の口座引き落としを継続できるとのことなのでそうした。


本棚を買う？ http://www.interiinu.net/?pid=6295092 無駄にスペースを食う(本の前や本棚の上)が嫌いだったのでこれはいいかも。

<hr>
- ■ 引っ越しの見積もりを比較する
- □ 引っ越し業者を決めて連絡を入れる
-- ただ今電話が混み合っております
- □ 冷蔵庫は3日前くらいまでに空っぽにして電源を切らなければならない
-- 当分は冷蔵庫の中のものを消費する食生活
- 電気の開通をしないと新居が寒くて長いこといられない

- □ ガス、電気、水道開通
-- ■ ガス
--- □ 25日 17-19にopen
--- □ 28日 9-12にclose
--■ 水道
--□ 電気
--- 「電話が大変混み合っております」
--- □ 明日の午前にでももう一度かける

-- □ どこに何を連絡すればいいのかを調べる
-- □ とりあえずハロゲンヒータを運ぶ？
--- ■ ←自転車に積んだ荷物を固定するためのゴムひもを探す
--- 自転車で荷物を運ぶことを考えた場合、すでにコンテナに入っているものとかを自力で運ぶことにメリットがない気がする。どっちみち最終的に引っ越し業者が運ぶので。なので梱包されていないものなどを袋やかばんに詰めて輸送することからはじめるのがいいかもしれない。
- ルミナス(棚)は分解して自分で運ぶのが手っ取り早い？長いポールがあるけど自転車で運ぶことが可能か？固定できれば押して歩いても遠くないから大丈夫？
- 掃除してから片付けようとか思っていたけど気がついたらあと5日しかないので運べるものから新居に運んで作業スペースを作るか。
-- 棚は配置の要でもあるのでさっさと運んでしまったほうがいいのかもな
-- ←棚を分解するためのワークスペースを作る(部屋半ばまでを片付ける）

- □ 郵便を転送する設定
- □ 住民票の変更、免許の住所変更
- ■ こういう作業メモをオフラインで書くのはあれなのでhowm on Dropboxにする。
- □ 引っ越し前に洗濯機の中身を洗濯する
- □ 手帳に古い住所などの情報がいっぱい書かれているので近いうちにデジタルデータを更新してプリントアウトして差し替える。

*1235337372*[topcoder]累乗剰余のテスト
TopCoderとかでたまに出る「値が巨大になるのでNであまりを取って答えてね」のためにあまりを取る階乗とかを作って用意しておいた方がいいのかなー、なんてことをid:suztomoに話したらこんなサイトを教えてもらった: <a href='http://www.prefield.com/algorithm/math/powmod.html'>Spaghetti Source - べき剰余</a>

で、今読んでいたんだけど、これって x * x がIntの上限を超えるときに powMod(x, 2) されても大丈夫なんだろうか。


というわけで試してみた。
>|cpp|
int main(){
  Int x = 1 << 30;
  DP(x);
  DP(x * x);
  DP(powMod(x, 2, 10));
  DP(((x % 10) * (x % 10)) % 10);
}
||<

結果
>||
x: 1073741824
x * x: 0
powMod(x, 2, 10): 0
((x % 10) * (x % 10)) % 10: 6
||<

うん。正しい値は6なのに0が返ってしまうね。

<hr>

その後の流れ
-1: 自分で実装しようと考える
-2: 何度も繰り返し呼ばれるわけだから計算結果をキャッシュする方がいいんじゃないかと考える
-3: x=1, 2, 4, 8, 16, ... の時の結果を先に作って持っておいてもO(log(N))だよなと考える
-4: 一回計算してグローバル領域に持っておけばいいんじゃないかと考える
-5: ふとそれでいいのか確認したことがなかったことに気づき、TopCoderでグローバル領域にカウンタを持って10回目のテストでfailするようなコードをシステムテストにかけてみる
-6: なんとfailしない！グローバル領域にキャッシュしてテストケース間で使い回しをする戦略は使えない
-7: ならコンパイルタイムに計算するしかない。
-8: しばらく考えてうまくいかなかったので専門家(@earth2001y)に聞こうと思ってTwitterでやりたいことの説明を書く
-9: 送信前に「いや、Mが固定なんだったらそもそもコンパイル時に向こうで計算する必要すらないだろ」と気づく
-10: 勘違いだったと気づく(「xが固定なら」の間違い)
-11: でも少なくとも素数テーブルは持っていても損はないよな

*1235338860*java-ja温泉に人が集まらない5つの理由
- 24時間かけ流し温泉&24時間会議室での開発合宿だってことがPython温泉を知らない人には伝わりにくい
- すでに13人申し込んでいてあと2人参加者がいれば開催できる状態だというのに、誰でも見られる説明ページの方が参加者6人のまま更新されていなくて計画が頓挫しそうなオーラを放っている
- 同じ場所で何回か開催したPython温泉の記事とかにリンクを貼った方が開催場所の雰囲気がわかっていいんじゃないだろうか。とっさにいい記事が見つからないけど<a href='http://d.hatena.ne.jp/Voluntas/20081026/1225024120'>第４回 Python 温泉 (まとめ) - Twisted Mind</a>とか。
- 僕はPython温泉からの類推で「当然Java限定という縛りもないし強制的な発表もないはず」と思って参加しているけどもそれってどこかに書いてあったっけ…前回のPython温泉では僕はHaskellで最中限を書いていたけども、今回のJava-ja温泉ではGoogle App Engineをいじるつもりでいる。
- 参加資格がとてもid:Yoshiori的な表現の仕方になっている。

<a href='http://java-ja.yoshiori.org/index.php?%E7%AC%AC%E5%8D%81%E4%B8%89%E5%9B%9E'>第十三回 - java-jaβ(秋)</a>

*1235354200*re: Twitterやってるやつらにありがちなこと
http://anond.hatelabo.jp/20090223041757

Twitterで9105人followしている僕が自分のタイムラインから観測できることを解説

-1: Twitterをやっている人の97%は日本語をしゃべる
-2: Twitterをやっている人の5人に4人はプログラマ
-3: Twitterをやっている人の中ではRubyistよりPythonistaの方が多い

ランダムにユーザを選んでfollowしているのでもない限り「Twitterユーザはこうだ」という主張は「自分のまわりにはこういう人がいる」と言っているにすぎない。そして大体人間って似たような属性の人同士で集まる(類は友を呼ぶ)ので、ほぼ「自分の属性はこうだ」と言っているようなもの。本人が自覚しているかどうかは知らないけど。近親憎悪って言葉もあるしね。

*1235361775*howm on ZumoDrive
2009-04-14 追記: 2回もファイル消滅が起きたのでZumoDriveはやめてDropBoxにした。履歴が残っているから大惨事にはならなかったけども、いちいち履歴から復帰させるのが面倒。
<hr>

howm(ひとりお手軽Wikiもどき)を1GB無料のZumoDriveの上で動かすと、
- オフラインで自分だけのWikiに色々書けて自由度の高いタスク管理&プロジェクト管理ができ、
- かつオンラインになったときに自動的に暗号化されてAmazonS3上に保管されるので自分の他のマシンなどともシェアでき、
- 自分のマシンがクラッシュした場合はもちろんたとえ家ごと火災で丸焼けになったとしても失われないバックアップになる
ってわけでアイデアのメモをがんがんためておく場所としては最適なんじゃないかと思ったので試してみる。

-1: ZumoDriveのサイトに行ってSign upする http://zumodrive.com/
-2: howmのサイトに行って最新版をダウンロードする http://howm.sourceforge.jp/index-j.html
-3: ダウンロードした最新版を展開して./configureとsudo make installする
-4: ~/.emacs.el に書き足す
>|lisp|
(setq howm-menu-lang 'ja)
(require 'howm)
||<
-5: 両方の式の後ろでC-x C-eして評価させる
-6: C-c , , してみる。メニューが出た。めでたしめでたし。
-7: ZumoDriveをインストールする
-8: howmのデータ保存領域をZumoDrive上に移動する。ちなみに初めて僕のブログを見る人のために書いておくとOSはMacBook。ZumoDriveはWindowsでも動くらしいけど試していない。
>||
$ mv ~/howm /Volumes/ZumoDrive/Documents/
||<
-9: howmの設定でデータ保存場所を変えてもいいのだろうけど~/howmにあるのはそれはそれで便利な気がするのでシンボリックリンク
>||
$ ln -s /Volumes/ZumoDrive/Documents/howm/ howm
||<
-10: あらためてemacsでC-c , ,する。ちゃんとメニューが開いた。
-11: howmで新規ファイル作成をして保存をしたら/Volumes/ZumoDrive/Documents/howm/2009/02/2009-02-23-122113.howm が生成された。これでOKのはず。しばらく使ってみる。

追記: 設定で「Documentはalways cache」にした。これで必ずローカルにファイルが残ることになるはず。

*1235369658*文字化けクイズ(解答編)
問題編をまだ見ていない人は<a href='http://d.hatena.ne.jp/nishiohirokazu/20090219/1235039106'>文字化けクイズ(問題編)</a>を先にご覧ください。



-Q1(初級): 「こんにちは、世界」と表示されるはずなのになぜか「縺薙」などの難しい漢字が表示された。何が起きたか。
-A1: UTF-8でエンコードされているバイト列をShift_JISだと思ってデコードするとこうなりますね。よく見かけるのがUTF-8で保存されているウェブページをブラウザで開いたときに自動判定に失敗してしまったケース。UTF-8の有名なサイトとしては<a href='http://ja.wikipedia.org/wiki/%E3%83%A1%E3%82%A4%E3%83%B3%E3%83%9A%E3%83%BC%E3%82%B8'>Wikipedia</a>なんかがあるので、これを開いてエンコーディングをShift_JISにすることで簡単に体験できます。Firefoxだとメニューから「表示」→「文字エンコーディング」→「日本語(Shift_JIS)」ね。


Pythonでこの文字化けを再現するコードはこちら:
>||
>>> print u"こんにちは".encode("utf-8").decode("sjis")
縺薙ｓ縺ｫ縺｡縺ｯ
||<


採点基準: UTF-8(10点), Shift_JIS(10点) の合計20点。utf8, sjis, cp932などでもOK。


-Q2(初級): 「こんにちは、世界」と表示されるはずなのになぜか「&#227;」(aの上に~)などが表示された。何が起きたか。
-A2: 同じくUTF-8でエンコードされているバイト列をlatin-1(ISO-8859-1)だとおもってデコードするとこうなります。同じようにWikipediaを開いて「西欧(ISO-8859-1)」を選べば体験できます。


Pythonでこの文字化けを再現するコードはこちら:
>||
>>> print u"こんにちは".encode("utf-8").decode("latin-1")
(はてなダイアリーだと〓に置き換えられてしまうので省略)
||<


採点基準: UTF-8(10点), ISO-8859-1(10点) の合計20点。latin1などの表記でもOK。


あんまりブラウザでの文字化けの話ばっかりでも面白くないので省きましたが、半角カナだらけになる化け方もよく見かけますね。これはEUC-JPでエンコードされているものをShift_JISでデコードしたときに起きる現象。はてなはEUCなのでShift_JISで表示させると半角カナだらけの化け方を体験できます。


-Q3(中級): ブラウザであるリンクをクリックしたところ「臼NG」で始まる謎の文字列が表示された。何が起きたか。
-A3: これはPNG形式の画像ファイルをShift_JISで開いたときに起きる現象ですね。臼NGはPNGのヘッダの最初の4バイトをShift_JISでデコードした文字列です。サーバの設定がおかしくてContent-typeヘッダが適切な値になっていないなどが原因ですが、サーバ側の問題なのでユーザ側でできる対処としては例えばファイルに保存して拡張子をpngにしてから開くとかになるでしょうか。


採点基準: PNG(10点), 「<span style="font-weight:bold;">サーバ側で</span>(5点)適切に<span style="font-weight:bold;">ファイルの種類</span>(5点)を返していない」という趣旨の記述。合計20点。


-Q4(上級): 「こんにちは」と表示されるはずなのになぜか「S?kao」と表示された。何が起きたか。
-A4: これは「こんにちは」が16ビットのUCS-2で表現されているにもかかわらずそれを受け取る関数が8ビットのバイト列として文字列が渡されることを期待していて、16ビットのうちの下8ビットだけを使って残りを捨ててしまったときに起こる現象です。僕がこれを最初に見たのはJython2.1でPythonのユニコード文字列をSwingのJFrameのコンストラクタに渡したときです。その他にもマルチバイト圏以外で作られたソフトやウェブサービスを使うとたまに目にするように思います。


この現象を再現するPythonコードは:
>|python|
>>> print "".join(chr(ord(c) % 256) for c in u"こんにちは")
S?kao
||<


採点基準: UCS-2または16bit(10点), 上位バイトが失われるという趣旨の記述(10点)の合計20点。


-Q5(上級): 「ファイルが見つかりません」と表示されるはずなのになぜか斜め四角に囲まれた疑問符などが表示された。何が起きたか。なお参考までに表示された文字列は20文字であり、表示されたウェブページのエンコーディングはutf8だった。(追記：6文字目までがが?t?@?Cになっている、という情報も付け加えるとエンコーディングまで含めて特定できるか。そこまで求める問題のつもりじゃないけど。)
-A5: あるバイト列をユニコード文字列にデコードする際に変換テーブルにない文字が出現した場合、Pythonでは例外(UnicodeDecodeError)を投げるstrictモードがデフォルトになっていますが、他の言語環境では無視して続行する(ignore)や適当な文字で置き換える(replace)などのモードがデフォルトの場合があります。問題文に書いてある「斜めの四角に囲われた疑問符」はユニコードのREPLACEMENT CHARACTER(U+FFFD)で、replaceモードのときに置き換える対象としてこの文字を使うケースが多いです。<a href='http://en.wikipedia.org/wiki/Replacement_character'>Unicode Specials - Wikipedia, the free encyclopedia</a>を参照。この文字はUTF-8でエンコードした場合に3バイトになるので、例えば1バイト目や2バイト目で範囲外になった場合出力のバイト数や文字数が入力のバイト数や文字数の整数倍にならなくなります。

僕がこの現象を見たのは他のマシンでJavaプログラムがコマンドを実行した結果をネットワーク越しに送信して別のマシンで集計表示するというシチュエーションで、シェルが返した実行結果(8bit列)をそのまま別のマシンに送ってしまっていて、メッセージがASCIIの時や、受け手と送り手が同じデフォルトエンコーディングの場合には発覚しないけども、送り手がWindowsでSJISで送り、受け手がLinuxでUTF-8として解釈してしまった場合には化けるというケースだったかと思います。と記憶をたよりに書いたもののいま当時のメールを発掘してみると
>||
こ(82 B1)
↓
E3 83 BB EF BD BD
E3 83 BB EF BD BD

表(95 5C)
↓
E3 83 BB EF BD BD
5C
||<
なんて書いてあるので出題と全然違いますね。あれれ。どうりで当時の記憶より難易度が低く感じると…。


さてこの現象を再現するためのPythonのコードはこちら:
>|python|
>>> import codecs
>>> codecs.lookup("utf-8").decode(u"ファイルが見つかりません".encode("sjis"), errors="replace")
(u'\ufffdt\ufffd@\ufffdC\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\x82\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd\ufffd', 24)
||<


採点基準: replaceモードに関する言及(10点), REPLACEMENT CHARACTERまたはU+FFFD(5点), シェルの出力エンコーディングは環境依存である件の指摘(5点)の20点。WindowsまたはSJISという言及があればボーナス10点。
追加点: 3番をのぞく各問題ごとに、問題文の現象を再現するコードを1言語ごとに10点


解説とおおざっぱな採点基準を書いてみましたが楽しんでもらえたでしょうか。こんなのを書いている筆者も文字コードの話はあまり得意ではないので、なにか間違いや不正確な点などがありましたらご指摘ください。


おすすめ書籍
<iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=ikunoz-22&o=9&p=8&l=as1&asins=4798100307&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe><iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=nishiohirokaz-22&o=9&p=8&l=as1&asins=4873111080&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe><iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=nishiohirokaz-22&o=9&p=8&l=as1&asins=4320120388&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe><iframe src="http://rcm-jp.amazon.co.jp/e/cm?t=nishiohirokaz-22&o=9&p=8&l=as1&asins=4899770510&md=1X69VDGQCMF7Z30FM082&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>
</body>
<comments>
<comment>
<username>Yoshiori</username>
<body>今まで clmemo + Dropbox でやってたけど howm + DropBox でやってみる！！</body>
<timestamp>1235372829</timestamp>
</comment>
<comment>
<username>TOKOROTEN</username>
<body>Python温泉だと、コードが好きな奴がいってるんだなって思うけど、<br>Java-jaだと、はてな界隈でくねくねしているプログラマーが行くんだなと思ってしまう。<br>名前からあふれ出る妙な身内くささが原因なんじゃないかなぁ。<br>自分も、java-ja温泉じゃなくて、java温泉だったら行きたいと思うｗ</body>
<timestamp>1235407099</timestamp>
</comment>
</comments>
```


[はてなダイアリー 2009-02-23](https://nishiohirokazu.hatenadiary.org/archive/2009/02/23)