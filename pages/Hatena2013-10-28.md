---
title: "Hatena2013-10-28"
---

hatena

```
<body>
*1382887406*量子将棋が面白い
量子将棋というゲームが遊べるようになったということで、さっそくプレイしてみた。ルールは簡単に言うと、すべての駒は量子的な重ね合わせの状態にあり、どう動かしたかによって駒の状態が収束する。王将に収束した駒を取れば勝ち。(追記: ルールの解説書きました: <a href='http://d.hatena.ne.jp/nishiohirokazu/20131028/1382954363'>量子将棋 Q&A</a>)

2勝2敗で結構面白かったので流れ去ってアクセスできなくなる前に感想をメモ。

** 1回目(勝ち)
棋譜: http://shogitter.com/kifu/884

僕の戦略
- 駒の種別が確定すれば取れる選択肢が減る。ということは必要がない限り駒は動かないほうが良い。動かさなければいけないのであれば歩の振りをするのが一番可能性が狭まらない。
- 王将に確定した駒を取れば勝ちなのであれば、相手の「王将かもしれない駒」をどんどん取って行って可能性を狭めるべき。

感想
- 駒の上にマウスポインタを置くと可能性のある駒の種類が出てくる
- 飛車を取るのがいいことなのかどうか悩む。「飛車でしかない駒」なので。

** 2回目(勝ち)
棋譜: http://shogitter.com/kifu/885

僕の戦略
- 1回目で勝ったので「王将かもしれない駒をどんどん取る」を続行
- 相手の「王かも駒」をなる早で減らすために、相手から取った「桂馬かも駒」で両取りを掛けて交換しまくる

感想
- 自分が香車のつもりで使った駒を、相手が「打って、横に動かす」によって飛車に収束させ、僕の駒のすべてから飛車の可能性が奪われた
- 「持ち駒」があることによって、自分だけではなく相手の駒の確率も変えられるのか！
- 相手の「王将かも駒」が2枚になったあと、片方が入玉。詰めやすい入玉してない方を囲んで、さあ取ろうか、と思ったが冷静に考えるとそれを取ると入玉している方が本物の王になってしまう。詰めにくい方を先に取らなければいけない。大変。
- 王かもしれない状態を保ったまま散らばられると両方追い詰めないといけないから大変だな。

** 3回目(負け)
棋譜: http://shogitter.com/kifu/894

僕の戦略
- 勝ったので「王かも駒をどんどん取る」続行
- 機会があれば「相手から取った香車飛車を飛車に確定」をやろう

感想
- 取られた駒を相手が角に確定、まだ事の重大さに僕は気づいていない
- 着々と相手の「王かも」との交換を繰り返す
- 「よし、相手の駒がたくさん歩兵になった！」と思った(109手目)が、気づくと僕はとっくの昔(91手目)に「歩王」に収束させられていた。自分が動かしていない駒から、83手目で金、64手目で銀の可能性が消えていた。
- これは相手が「相手からとった香車飛車を飛車に確定させて、残りの駒から飛車の可能性を奪う」を一般化して応用した結果
- 歩王や歩香王になってしまうと、隣に敵の駒が来ても、それを取れば王に確定してしまう関係上ためらいが生じる
- 確率分布が収束して普通の将棋に近づくと僕は将棋の経験が乏しいため不利

** 4回目(負け)
棋譜: http://shogitter.com/kifu/899

僕の戦略
- 上記「相手の金銀の可能性を奪う」戦略を教えてもらったので実行しよう

感想
- 僕が後手で、先手が初手でどまんなかに香車飛車を突っ込んで成るという急襲を掛けたので「相手の金銀の可能性を奪う」とか考える余裕がなくなった
- 香車飛車を2枚打って「相手の香車飛車が下がったら飛車に確定するから交換しても損しない」と思ったが、相手の香車飛車が下がって飛車に収束したところで、自分の香車飛車が香車に収束して大損
- 対戦相手が「普通の将棋に近づいた」と言っている一方、僕は混乱を深める
- おそらく原因は、僕に将棋の基礎体力がないことで駒が過去にどう動いたかを覚えていないため。その結果、確率収束の具合はマウスホバーして出てくる「残りの可能性」のツールチップに頼るしかなくアクセス性能が非常に悪い。
- 42手目、11個残っている自分の未確定コマのうち、金が1枚、王が1枚であることを理解しないままその内の1枚を横に動かしたために急激な確率収束が発生、王将が2枚に絞られる
- 47手目でその片方が取られ王将を特定される
- 慌てて効きのあるところに王を動かしてあっさり取られる

** まとめ

量子将棋は2勝2敗、僕に将棋の基礎体力がないため「自分がその駒を過去にどう動かしたか」や「どれが相手から取った駒か」がわからず、使っている戦略を聞いたあとでもそれを実行することができないようだ。基礎体力は応用編を戦う時でも重要。 

将棋よりは囲碁のほうが得意なので量子囲碁を…と思ったが囲碁は2000年以上前から「石は死んでいる状態と生きている状態の重ねあわせであり、石の生死が確定すると周囲のマス目が白地か黒地か駄目かが決まり、その多寡を競う」という量子的なゲームであった。二眼あれば生に収束！

*1382894200*量子将棋の状態をわかりやすくするスクリプトを作った(pre-alpha)
>||
$('.koma').parent().each(function(){$(this).css('position', 'relative'); $(this).append($('<span style="position: absolute; left: 0; top: 0; color: blue; font-size: 65%; float: left; display: block; background: #fff;">' + this.title + '</span>'))})
||<

[f:id:nishiohirokazu:20131028021428p:image]

今は親にposition: relativeをつけているせいで座標の原点がドキュメント左上になって駒の操作が難しくなるので、リロードで消す必要がある。表示しっぱなしでも操作できるようになると便利なんだけどな。

*1382954363*量子将棋 Q&A
昨日書いた手抜きの「量子将棋が面白い」記事が大人気ですが、ルールの解説を手抜きしたので誤解をしている人もいるようなのでQ&Aの形にしてみました。

** Q: 運が関係する？

NO。運が関係するのは先手後手を決める振り駒だけ。残りは通常の将棋と同様の、運の要素が全くない、実力100%のゲームです。

** Q: え？駒を取った時にその駒が確率でどの駒だったか確定するんじゃないの？

NO。それは軍人将棋からの連想なのかもしれないけども、正しくありません。例えば「香車か飛車のどっちか」という駒を取ったら、そのまま「香車か飛車のどっちか」として使えます。

** Q: 打つときに香車として使うか飛車として使うか決めるの？

NO。打った直後は「香車か飛車のどっちか」という重ね合わせの状態です。もちそんその後で後ろに動かせば、香車がそのような動きをすることはありえないので、その駒は飛車であることが決まります。他にも、例えば相手陣地の一番奥にそれを打てば、香車をそこに打つことはルール上不可能なので飛車に決まります。

** Q: 初期状態でどれが王将かわからない？

その質問は曖昧なので、答えはYESにもNOにもなりえます。
「初期状態でどれかが王将で、それがどれなのかプレイヤーにわからない？」という趣旨の質問なら、答えはNO。
「最終的にどれが王将に収束するか、ゲーム開始時点ではわからない？」なら答えはYESです。
初期状態ですべてが王将の可能性を持っており、最終的にどれが王将に収束するかはその後のプレイヤーの操作依存です。だからゲーム開始時点ではわからないわけです。プレイヤーがどういう操作をした時に駒の確率値がどういう変化をするかは完全に決定論的で運の要素はありません。どれが王将なのかがゲーム開始時にわからないのは「プレイヤーがその後どういう操作を行うか」がわからないことが原因です。

** Q: 王将かもしれない駒を取ったら、あとからその駒が王将に収束して勝つことがあり得る？

NO。そこは「未確定の駒が取られた場合にはそれが王将である可能性は消える」というルールになっています。もし王将であればそれが取られたタイミングでゲームが終了するはずであり、終了しなかったという観測の結果によって王将である可能性が消えるわけです。

ここは「王将である可能性を持ったまま持ち駒になる」「打った時点で王将は打てないから王将でなかったことが決まる」というゲームデザインも理論上は可能だったと思います。ただ、そのゲームが楽しいかどうかはわかりません。

** Q: つまり王将がどれか確定していない状態でゲームが終了することは起こりえない？

YES。その通りです。王将として確定させていない駒を取っても勝ちにはなりません。

王将を詰ませたら勝ちなのか、取ったら勝ちなのか、という質問もありました。でも勝つ状況は「王将を特定して、それを詰める」と「王将を特定して、その王将が自殺」の2通りしかないので普通の将棋と同じです。ただまあ、うっかり後者の自殺をすることには気をつける必要があるでしょうね。例えば香車がどこにあるか特定されてない状況だと、香車かも知れない駒が全部前一列の効きを持っているので危険です。

追記：超レアケースですが「相手から取った銀金で後ろに下がって相手の金王を取る」というケースで「後ろに下がるアクション」で銀金が金に確定し、その結果として金の枚数制約から相手の金王が王に確定し、王が取られたことにより終局、というパターンが存在するので。100%YESとは言えないことがわかりました。棋譜: http://shogitter.com/kifu/1090

** Q: 確定前の駒が敵陣に入ったとき成りの扱いは？

「成るか？」と聞かれます。そこで成ることを選べば、元の駒が金や王である可能性は消えます。逆に、一番奥まで行ったのに成らなかったとすると、歩兵や香車の可能性が消えます。

** Q: 相手が二歩になるように持ち込むのが有利？

NO。二歩のルールはありません。もし二歩のルールがあると、歩が特定される速度が増えるでしょうね。ゲームデザインとしてはその選択も可能だと思いますが、たぶん収束が速すぎて面白くないと思います。

** Q: どこで遊べるの？

http://shogitter.com/ にTwitterアカウントでログインして「新規対局」して、ルール一覧から「108: 量子将棋」を選べばOK。Twitterで不特定に対戦相手を探したり、特定の人を誘ったりできます。

** Q: どれくらいの時間が掛かるの？

そりゃ1手にどれくらい掛けるか依存ですけど、50～150手ぐらいで決着が付くイメージです。今日の昼休みにやったのは40分くらいでした。速い時は12分、遅いとき(僕が詰めようとして追いかけ回した結果結局詰められなくて150手くらい掛かったとき)は1時間を超えたかな。

** Q: 要は特定されないように歩のふりをして全面一歩ずつ進むとか、中の隙間でウロウロするとかすればいいんでしょ。

初手で歩の位置にある駒を香車のように動かして相手の陣地のコマを取ることができるので足並み揃えた行進は不利だと思います。飛び込んできた駒を取り返しても、取られた駒がオールマイティで取替した駒が香車飛車という交換ですし、相手は1手で適当な駒を飛車に確定してその香車飛車を香車に変えてしまうことができますから。

** Q: 王将を特定するまでにどれくらいかかるか？

僕の最短記録は15手目で王将特定 http://t.co/ltzncNhwqP

** Q: 将棋が強い人のほうが強い？

駒の収束がすすめば、どんどん普通の将棋に近づくので、将棋が強ければ終盤は有利です。

筆者は昨日本屋で「初級三手詰め」を読んでみたら1問目から解けなかったレベルで将棋が弱いので、そういう状況になると不利だったり、詰むかどうか読むことができずに相手の王将を追いかけまわして駒を無駄にしてしまったりします。将棋で鍛えた「3手先を読む力」とかは基礎体力として量子将棋でも有効なのでしょう。

一方で、序盤に関しては、量子将棋に独自の「王将特定ゲーム」なので、将棋の力とは独立性が高いように思う。「不確定な状態のまま1手で複数の狙いのある手を選ぶことで1手の効率を上げる」とかは、筆者の場合は囲碁の経験から応用されているイメージです。

** Q: とりあえず全部の駒を歩のように1歩ずつ上げていけばいいよね

NO。それは不可能ですね。17個目の駒を上げた時点で残りの3枚が「桂馬か角」に収束します。20枚の中に3枚前に進めない「桂馬か角」がある条件を満たすにはそうなるしかないですから。

** Q: 王手になっているかどうかがわからない？

その質問は曖昧なので、答えはYESにもNOにもなりえます。「王手」という言葉で「次に王を取られて死ぬ状態」を指しているのなら、答えはNOです。上記「王将がどれか確定していない状態でゲームが終了することは起こりえない？→YES」を参照。

一方で「自分の手や相手の手によって王が特定された際に、その王にすでに王手がかかっている」という状態は起こります。特に自分で王を特定した場合は自殺になりますね。

** Q: 先手有利？

筆者の主観ですが、今のところその可能性が濃厚ですね。慣れた人は自分が後手を取って、その上で逆転して勝利することを目指すとよいと思います。

もし量子将棋が本格的に先手有利であることが明らかになったら、後手にまったく動けない駒「石」を1個追加し、初期配置に５二を追加するとよいのではないかと思います。将棋としては合駒ぐらいにしか役立たない駒が増えただけであまりバランスを崩さず、一方で対戦相手が能動的に確定をできない不確定駒が追加されたことで量子将棋としてのバランスだけ調整できると思います。もしくは「後ろに下がる」しかできない「逆歩」を追加すると、相手の駒を後ろに下げた時に今は金飛に収束しているのが逆歩の可能性も残るようになる。「後ろと斜め後ろの3マス」だけの駒を追加することで金特定パスと銀特定パスを絡ませる。この辺りがあんまり将棋としてのバランスを壊さずに量子将棋のバランスを調整するのに有効かなと思います。

** Q: 完全情報ゲームだよね？

僕も完全情報ゲームだと思い込んだまま10局以上プレイしましたが、答えはNOです。現時点でのルールでは「相手の持ち駒に同程度に収束した自分由来の駒と相手由来の駒があった場合に、どちらが打たれたかがこちらにはわからない」という理由で完全ではありません。ちなみにこれに気づいた理由は「自分の持ち駒に同程度に収束した相手由来の駒と自分由来の駒があって、相手の駒を収束させるつもりで間違えて自分の駒を打ってしまう」というミスをしたからです…。

** Q: 量子将棋は人生？

<a href='http://d.hatena.ne.jp/nishiohirokazu/20131031/1383230688'>量子将棋は人生</a>。
</body>
<comments>
<comment>
<username>nlogn</username>
<body>「起こりえない？→YES。その通りです」では，質問が否定疑問文に見えるので，日本語的な「はい」を「YES」で書くのは混乱するような… (単に表現の問題です)。</body>
<timestamp>1383000685</timestamp>
</comment>
<comment>
<username>kobayashi_shinji</username>
<body>appendしてるspanにpointer-events: none;も指定すればIE11以降、その他イケてるブラウザで操作できると思います</body>
<timestamp>1383101772</timestamp>
</comment>
<comment>
<username>nishiohirokazu</username>
<body>僕の脳内では「起こりえない？」が「Is X impossible?」だったようです。ここは自然言語で表現するかぎり誤解の余地はなくならないでしょうね。</body>
<timestamp>1383274494</timestamp>
</comment>
<comment>
<username>JL</username>
<body>面白いですね！将棋やチェス、象棋などさまざまに派生したボードゲームがありますが、派生ゲームとして立派に成立したルールになっていると思います。<br>ぜひプロ棋士が指すのを見てみたいという気がしてきました。</body>
<timestamp>1383408379</timestamp>
</comment>
<comment>
<username>tasbranded</username>
<body>つけているせいで座標の原点がドキュメント左上になって駒の操作が難しくなるので、リロードで消す必要がある。表示しっぱなしでも操作できるようになると便利なんだけどな</body>
<timestamp>1383542402</timestamp>
</comment>
<comment>
<username>nlogn</username>
<body>なるほど！</body>
<timestamp>1383921350</timestamp>
</comment>
</comments>
```


[はてなダイアリー 2013-10-28](https://nishiohirokazu.hatenadiary.org/archive/2013/10/28)