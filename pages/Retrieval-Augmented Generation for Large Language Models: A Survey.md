---
title: "Retrieval-Augmented Generation for Large Language Models: A Survey"
---

[2312.10997 Retrieval-Augmented Generation for Large Language Models: A Survey](https://arxiv.org/abs/2312.10997)
<img src='https://scrapbox.io/api/pages/nishio/claude/icon' alt='claude.icon' height="19.5"/>本論文は、大規模言語モデル(LLMs)の性能を向上させるRetrieval-Augmented Generation ([[RAG]])技術に関する包括的な調査論文である。主な内容は以下の通りです。

1. RAGの発展は、Naive RAG、[[Advanced RAG]]、[[Modular RAG]]の3つのパラダイムに分類できる。それぞれ、前のパラダイムの限界を克服するために開発されてきた。
2. RAGフレームワークの3つの基盤となるコンポーネントは、Retrieval、Generation、Augmentationである。それぞれのコンポーネントにおける最先端の技術が詳細に検討されている。
3. RAGの主要なダウンストリームタスクと、それらを評価するための最新の評価フレームワークとベンチマークが紹介されている。
4. RAGは現在いくつかの課題に直面しているが、ロバスト性の向上、長いコンテキストへの適応、マルチモーダルへの拡張など、将来の研究開発の方向性が示されている。
5. RAG技術は、パラメトリックな知識と非パラメトリックな外部データベースを相乗的に統合することで、LLMsの能力を大幅に向上させることができる。

RAGの技術は急速に発展しており、学術界や産業界から大きな注目を集めている。今後のAI分野の発展に大きな影響を与えると期待されている。

<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>Advanced RAGはどのような問題を解決しているか

<img src='https://scrapbox.io/api/pages/nishio/claude/icon' alt='claude.icon' height="19.5"/>Advanced RAGは、Naive RAGの限界を克服するために開発された手法です。具体的には以下のような問題を解決しています。
1. 検索の質の向上：
    - Pre-retrievalの段階で、インデックスの構造や元のクエリを最適化することで、検索の精度と再現率を向上させる。例えば、データの粒度を上げる、インデックス構造を最適化する、メタデータを追加する、クエリの書き換えや変換を行うなどの手法が用いられる。
    - Post-retrievalの段階では、検索された情報を関連性に基づいて再ランク付けしたり、重要な情報を選択して圧縮したりすることで、生成段階に渡すコンテキストの質を高める。
2. 生成の質の向上：
    - 検索された情報をそのまま言語モデルに入力するのではなく、情報の重要度に応じて再配置したり、不要な情報を削除したりすることで、生成される回答の質を向上させる。また、タスクに特化した言語モデルのファインチューニングを行うことで、より適切な回答を生成できるようにする。
3. 拡張段階の効率化：
    - 検索された情報を統合する際に、重複する情報を削除したり、タスクに適した形式に変換したりすることで、拡張段階の効率を高める。また、検索と生成を反復的に行うことで、複雑な問題に対してより適切な回答を生成できるようにする。

Advanced RAGは、これらの手法を組み合わせることで、Naive RAGの問題点を総合的に解決し、RAGシステム全体の性能を向上させることを目的としています。

<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>Pre-retrievalの改善にはどのようなものがあるか

<img src='https://scrapbox.io/api/pages/nishio/claude/icon' alt='claude.icon' height="19.5"/>Pre-retrievalの改善には以下のような手法があります。

1. インデックス構造の最適化：
- - 階層的なインデックス構造を構築することで、関連する情報を素早く検索できるようにする。
- - ナレッジグラフを用いてドキュメント間の関係性を表現し、検索の精度を向上させる。

2. チャンク分割の最適化：
- - 文書を固定長のトークン数で分割するのではなく、文の境界で分割することで、セマンティックな完全性を維持する。
- - スライディングウィンドウ法を用いて、チャンク間の重複を許容することで、コンテキストの欠落を防ぐ。

3. メタデータの追加：
- - ドキュメントのメタデータ（ページ番号、ファイル名、著者、カテゴリ、タイムスタンプなど）をチャンクに付与し、検索時のフィルタリングに利用する。
- - 要約や仮想的な質問などの人工的なメタデータを追加することで、質問と回答の意味的なギャップを埋める。

4. クエリの最適化：
- - 複数のクエリに展開することで、単一のクエリでは捉えきれない文脈を補完する。
- - 複雑なクエリを副次的なクエリに分解することで、検索の精度を向上させる。
- - LLMを用いてクエリを書き換えることで、検索に適した形式に変換する。
- - ステップバックプロンプティングを用いて、クエリを抽象化することで、より広範な検索を可能にする。

5. クエリのルーティング：
- - クエリのメタデータや意味情報に基づいて、適切な検索手法や検索対象を選択する。
- - 複数の検索手法を組み合わせることで、検索の網羅性を高める。

これらの手法を適切に組み合わせることで、検索の精度と効率を向上させ、より質の高いコンテキストを生成段階に提供することができます。

<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>
[[階層的なインデックス構造]]を構築すると、なぜ関連する情報を素早く検索できるようになるのか？
[[ナレッジグラフ]]は具体的にどう使うのか？
[[要約]]の活用について詳しく。
クエリをどのようにして[[副次的なクエリに分解]]するのか？
[[ステップバックプロンプティング]]とは何か？

<img src='https://scrapbox.io/api/pages/nishio/claude/icon' alt='claude.icon' height="19.5"/>
1. 階層的なインデックス構造を構築すると、関連する情報を素早く検索できるようになる理由：
- - ドキュメントを親子関係で整理し、チャンクをそれらに関連付けることで、検索対象を絞り込める。
- - 各ノードにデータの[[要約]]を保存しておくことで、データの全体像を素早く把握でき、どのチャンクを取得すべきかを判断しやすくなる。
- - 階層構造を辿ることで、関連するチャンクを効率的に検索できる。

2. ナレッジグラフの具体的な使い方：
- - 異なる概念やエンティティ間の関係性を明示的に表現することで、文脈の一貫性を維持し、hallucination（幻覚）を軽減できる。
- - 情報検索のプロセスをLLMが理解できる命令に変換することで、知識検索の精度が向上し、文脈に沿った回答の生成が可能になる。
- - 複数のドキュメント間のインデックスを構築する際に、ナレッジグラフを用いることで、ドキュメントのコンテンツと構造の論理的な関係性を捉えられる。

3. 要約の活用について：
- - ドキュメントの要約を人工的な[[メタデータ]]として追加することで、質問と回答の意味的なギャップを埋められる。
- - 要約を検索時のフィルタリングに利用することで、検索の精度を向上させられる。
- - 要約を基にした[[再帰的な検索]]を行うことで、長い文書や複雑な構造を持つPDFなどを効率的に処理できる。

4. クエリの副次的なクエリへの分解方法：
- - 複雑なクエリを、それを構成するより単純な副次的なクエリに分解する。
- - 副次的なクエリを組み合わせることで、元のクエリに対する回答を導出する。
- - 分解には、[[least-to-mostプロンプティング法]]などを用いる。

5. ステップバックプロンプティングとは：
- - 元のクエリを抽象化して、高レベルな概念の質問（[[ステップバック質問]]）を生成する手法。
- - RAGシステムでは、ステップバック質問と元のクエリの両方を検索に使用し、その結果を言語モデルでの回答生成の基礎とする。
- - より抽象的な質問を生成することで、検索の範囲を広げ、より包括的な情報を取得できる。

これらの手法を適切に組み合わせることで、RAGシステムの検索効率と生成される回答の質を向上させることができます。

<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>
要約を基にした再帰的な検索とは？
least-to-mostプロンプティング法とは？

<img src='https://scrapbox.io/api/pages/nishio/claude/icon' alt='claude.icon' height="19.5"/>
1. 要約を基にした再帰的な検索：
- この手法は、長い文書や複雑な構造を持つPDFなどを処理する際に有効です。以下のようなステップで行われます。
    - a) 構造化インデックスを利用して、文書の一部（セクションやページなど）を処理・検索する。
    - b) 検索された部分の要約を作成する。
    - c) その要約を基に、文書内でさらに詳細な検索を行う。

- このように、要約を基にした再帰的な検索を行うことで、大量の情報を段階的に絞り込んでいくことができます。また、グラフ構造化されたデータソースからより深く関連情報を抽出するためにマルチホップ検索と組み合わせることもあります。

2. least-to-mostプロンプティング法：
- この手法は、複雑な質問を一連のより単純な副次的な質問に分解するために使用されます。以下のようなステップで行われます。

    - a) 複雑な質問を受け取る。
    - b) その質問を、より単純で具体的な副次的な質問に分解する。
    - c) 副次的な質問を順番に言語モデルに入力し、回答を生成する。
    - d) 生成された回答を組み合わせて、元の複雑な質問に対する最終的な回答を導出する。

- 例えば、「第二次世界大戦の主な原因は何ですか？」という質問を、以下のような副次的な質問に分解することができます。
    - - 第二次世界大戦はいつ起こりましたか？
    - - 第二次世界大戦に参加した主な国はどこですか？
    - - ナチスドイツの台頭はどのように第二次世界大戦の原因となりましたか？
    - - 日本の侵略はどのように第二次世界大戦の原因となりましたか？

- これらの副次的な質問に順番に答えていくことで、元の複雑な質問に対する包括的な回答を生成することができます。

- least-to-mostプロンプティング法を使用することで、複雑な質問をより扱いやすい形式に変換し、言語モデルの能力を最大限に活用することができます。