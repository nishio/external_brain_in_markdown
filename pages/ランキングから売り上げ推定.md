---
title: "ランキングから売り上げ推定"
---

ある売り上げランキングが「1位が1件、2位が2件、4位が5件同率」だった。ここから売り上げに関してどういう情報が得られるか？

- ランキングの対象となる商品が何種類あるかは未知である。Nとする。
- 一定期間内の売り上げ $X_i (0 \leq i < N)$ は未知。素直に考えるとXはポアソン分布に従う。
- ポアソン分布のパラメータ $\lambda_i$ は未知。範囲は0以上上限なし。
- lambdaの分布は未知なので無情報分布として $0 \leq \lambda_i < M$ の一様分布からサンプリング。
- そのパラメータのポアソン分布からサンプリング。
- 「1位が1件、2位が2件、4位が5件同率」という条件を満たしている物だけ取り出す(棄却サンプリング)

N=20の時の、M=(1, 2, 3, 4, 5, 10, 20)における、条件を満たすランキングの出現確率。
Mがgivenの場合の条件付き出現確率:

```
1 0.0149075730471
2 0.0170706725845
3 0.0149454491107
4 0.0165070980522
5 0.010323113451
10 0.00249382777625
20 0.000251332059918
```

というわけで最も出現確率が高いのはM=2の時。

その場合の1位、2位、4位の売り上げ数は(4, 3, 2)が40%、(3, 2, 1)が23%、(5, 3, 2): 134
1000件サンプリング中の出現回数:

```
(4, 3, 2): 403, (3, 2, 1): 225, (5, 3, 2): 134
```


N=40の場合も同様の実験でM=3の時が最も出現確率が高い(0.024)ことがわかる。その場合、(5, 4, 3)が44%。
1000件サンプリング中の出現回数:

```
(5, 4, 3): 441, (6, 4, 3): 194, (6, 5, 4): 136
```


N=80の場合もM=3が最も出現確率が高い(0.002)ことがわかる、その場合(6, 5, 4)が56%。
1000件サンプリング中の出現回数:

```
(6, 5, 4): 563, (7, 5, 4): 174, (8, 5, 4): 70,
```


なお、N=10, M=2の時の出現確率が0.0097、N=15, M=2の時の出現確率が0.029なので、Nはおそらく20弱だろう。

結論: たぶん一位でも3～5冊しか売れてない(悲しみ)

python:

```
buf = []
num_samples = 0
while True:
    lambdas = np.random.random(NUM_BOOKS) * MAX_LAMBDA
    sample = np.random.poisson(lambdas)
    sample.sort()
    sample = sample[::-1]
    num_samples += 1
    if (sample[0] > sample[1] and sample[1] == sample[2] and
        sample[2] > sample[3] and sample[3] == sample[7] and
        sample[7] > sample[8]):
        buf.append((sample[0], sample[1], sample[3]))
        if len(buf) == 1000: break
```


