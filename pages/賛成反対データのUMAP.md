---
title: "賛成反対データのUMAP"
---

賛成+1, 反対-1, 欠損0のベクトルのようなデータを[[UMAP]], [[DBSCAN]], [[HDBSCAN]]するときには注意が必要
なぜならこの種のデータはしばしば「同一点に重なるデータ」があり、近傍k個のデータ点をとって密度を計算する系のアルゴリズムから見ると「とても密度の高いクラスタがある」と見えるから

![image](https://gyazo.com/33db5afa7fee3f182b00dbd64a54e268/thumb/1000)
いかにも意味のありげなクラスタができている図
元データは「3%が+1、3%が-1、残りが0」という100次元のベクトル5000個

このUMAPのplotのうち「非ゼロの値が1個しかない点」を赤にするとこうなる
![image](https://gyazo.com/95c96b22678ea65e678f20b8195cf7d4/thumb/1000)
「意味ありげなクラスタ」に見えたものの中に芯のように赤い点があるのがわかる

「非ゼロの値が2個以上のデータ」4920件に限定してUMAPしなおすとこうなる
![image](https://gyazo.com/9689803635bc2483f202bf33805ed273/thumb/1000)
さきほどの意味ありげなクラスタに見えたものがほとんど消えて、単なるアーティファクトだったことがわかる

個数を数えてみる
![image](https://gyazo.com/44e6cf0408866a29384d135d7bcacb1b/thumb/1000)
原点のデータが8個、たまたま2個重なってるデータがいくつか(12個だった)

この2個重なっている点だけを赤でplotしたものがこれ
![image](https://gyazo.com/a975353317cd7b1eec001355ed9d0484/thumb/1000)
アーティファクトのクラスターの芯になっていることがわかる

---

これは生成データでだけ起こるトリッキーな現象ではなく、現実のデータでも起こること
現実のデータから得られた下記のようなUMAPに対してDBSCANでのクラスタリングを試行錯誤していた
![image](https://gyazo.com/ca78ba9feeb5beabee68258e4128cdc9/thumb/1000)

2次元データからDBSCANしてもあまりうまくいかなかったので、次元削減前の84次元空間で試していたが、パラメータによっては「中央付近の明らかにクラスタに見えるものを除外したクラスタ」ができて不穏だった
![image](https://gyazo.com/2f5bb5b150d2c2ceaa7eb3de6daa4e0c/thumb/1000)

この原因が何かを探究する過程でわかったが「中央付近のクラスタに見えるもの」が欠損値の少ないデータの集まりで、周囲の複雑な意味ありげな形だったものは欠損値多めのデータだった
![image](https://gyazo.com/66f90b8311c1343c4720c730623b1ca1/thumb/1000)
この結果を見て、欠損値多めのデータの密度が高いというところから上記のような現象に気づいた
元々このデータは`matrix.dropna(thresh=3)`してたのだけど、ここを`matrix.dropna(thresh=10)`に変えたところUMAPの結果は下記のようになった
![image](https://gyazo.com/6c91b8174f233a4441bc3c3fc66a7d08/thumb/1000)
複雑な形状はほとんどすべてアーティファクトだったというわけ

[[世論地図のUMAP]]
