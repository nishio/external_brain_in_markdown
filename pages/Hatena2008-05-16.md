---
title: "Hatena2008-05-16"
---

hatena

```
<body>
*1210939584*アイストレッチ
なんか最近目が疲れやすくて、夜帰る時とかに電灯にピントを合わせるのに掛かる時間がなかなか縮まらないので「アイストレッチ」という目薬を買ってきた。目の筋肉をほぐすメチル硫酸ネオスチグミンが入っているらしい。

あとアスパラドリンクSPが3本298円だったのでついでに買ってきた。

*1210947590*Pythonのタプルについて(三度目)
質問されたので答えてみた。

- 参考文献
-- 一回目(3年前)：<a href="http://www.nishiohirokazu.org/archived_coreblog/337">Pythonにおけるタプルの存在意義 @ NISHIO HIROKAZU # Archived COREBlog</a>
-- 二回目(2年前)：<a href="http://www.nishiohirokazu.org/blog/2007/02/python_16.html">西尾泰和のブログ: Pythonにおけるタプルの存在意義　リターンズ</a>

Q: 「一回目の記事を読んでなるほどと思ったのだけど、二回目の記事には『昔書いたよくない説明』と書いてあって、どのへんがよくないのかがわからないので教えてほしいです。」

A: 一言で説明すると「『変更可能だからハッシュ値を計算できず辞書のキーにすることができない』という説明は厳密には正しくない」となる。たとえばlistを継承してハッシュ関数を定義すれば変更可能なまま辞書のキーにすることが可能になるし、ユーザ定義のクラスのインスタンスはデフォルトのハッシュ関数を継承するので辞書のキーにすることができる。Pythonのリストが辞書のキーにできないのは「技術的に不可能」なのではなく「意図的に禁止してある」のだ。

-----

以下86世代チャットのログを適当に編集して読みやすくしたもの。

>>
N: どう納得した？
A: すげー便利じゃんっていう。タプルの使いどころみたいなものがいまいちわかってなかったけど、なるほど!と
N: うん、便利便利。タプルが辞書のキーになるのは便利。でもリストが辞書のキーになれないのはなぜ？なぜタプルとリストなんて2種類作って、片方のリストは辞書のキーになれないなんてことになってるの？
A: pythonの辞書の仕様
N: なんでそんな仕様にしたのか、ということね。だってリストが辞書のキーになれるならタプルいらないってことでしょ。
A: リストだとmutableだからこまる?
N: mutableだとなぜ困る？
A: リストの内容変えてもkeyとして使えて直観的でないとか
N: うん、それだ。リストをキーにして辞書に入れた後、そのリストを書き換えてしまったときに一体どういうことがおこるのか。
N: dict = {}; key = [1, 2]; dict[key] = 1したあとでkey.append(3)したときに、dict[key]が取得できるのかできないのか。
N: これはハッシュ関数の実装による。取得できるようにハッシュ関数を実装したなら「中に入っている物に無関係にハッシュ値が決まる」ということだよね。それだとdict = {[1, 2]: 1}に対してdict&#91;[1, 2]&#93;したときに値が取れない。なぜかというとその二つのリストは「たまたま中に入っている値が同じなだけの別のリスト」だから。
A: ああ、なるほど。
N: 逆にリストの内容が同じならば同じ値になるようにハッシュ関数を実装したなら「中に入っている物によってハッシュ値が決まる」わけだから、key.append(3)するとハッシュ値が変わってしまいdict[key]で値を取れなくなる。キーを書き換えても大丈夫にすることと、dict&#91;[1, 2]&#93;で値が取れるようにすることは両立できない。
A: なるほどなるほど
N: ちなみにPythonは「変更できないリスト」であるタプルを導入するって解決策をとったのだけど、Rubyは「キーにリストを入れられるかわりに、キーを書き換えたら値が取れなくなる」という選択肢を選んでいる。どちらを選ぶかってのは言語の設計上では選択肢の一つにすぎないんだな。実際問題としてハッシュのキーを書き換えて嬉しいシチュエーションって思いつかないし。
U: rubyは大クラス主義でなんでもありなんでそういうゆるい考え方、ととらえたらいいかな
N: 個人的にはタプルの導入は失敗だと思っている。Ruby流でいいじゃんと。
U: pythonにはちゃんと配列とタプル両方用意されてるんか
N: リストとタプルの2つがある。「なんだこれ、どう使い分けるんだ」ってのが誰しもが通る道ｗ
U: ということは、リストは中身が同一型制限あり?
N: のん
U: うええ
N: 中身に同一型の制限があるのはarrayｗ http://www.python.jp/doc/current/lib/module-array.html
U: ああ、リストとarrayとタプルがあるんかww それならリストとタプルの使い分けがわからんなあ
N: でしょでしょ
U: haskellとかだと明らかに違うから使いわけを考えるまでもないんだよね >list, tuple, array
<<
</body>
<comments>
<comment>
<username>ujihisa</username>
<body>Uwww</body>
<timestamp>1210947703</timestamp>
</comment>
<comment>
<username>nishiohirokazu</username>
<body>だっていちいち名前書くと長くて邪魔なんだもんｗ</body>
<timestamp>1210948190</timestamp>
</comment>
<comment>
<username>anatoo</username>
<body>>pythonの辞書の仕様<br>この辺が我ながらひどい</body>
<timestamp>1211005691</timestamp>
</comment>
<comment>
<username>hamatsu1974</username>
<body>リストとタプルの使い分け、ワタシはDive Into Python の説明で十分に納得しましたけど。。　そこでは１番のメリットは「値が一定のデータセットとして使うダケなら、リストよかタプルの方が処理が早いゼ！」ってコトになってました。勿論、辞書云々の話もありましたけど。<br><br>＃　西尾さんはここら辺も理解した上で冗談っぽく発言されているのでしょうが、こういう有識者の方のネット上での発言だけを見て「知ったか」する人への悪影響を考え、僭越ですがコメントした次第です。</body>
<timestamp>1211006976</timestamp>
</comment>
<comment>
<username>nishiohirokazu</username>
<body>「タプルいらないんじゃないか」のあたりですか。確かに「知ったか」する人に誤解されがちな表現でしたね…。<br><br>「変更できないものと変更できるものがあるとき、変更しない用途には変更できないものの方が適している」というのはPythonに限ったことではないんですよね。例えばRubyには変更できる文字列とできない文字列(Symbol)があってif(x == ”foo”)よりif(x == :foo)と書く方が速かったりします。でもスクリプト言語を使っている時点でCよりはるかに遅いので、この速度の差はそれほど本質的ではないわけですよ。<br><br>で「タプルは固定のかわりに速いリスト」という説明だとリストが辞書のキーになれない理由へつながらないんですよ。</body>
<timestamp>1211014823</timestamp>
</comment>
<comment>
<username>hamatsu1974</username>
<body>前提知識は人によってバラバラなので、受け止め方も人それぞれ。発言を吟味するのは難しいですよね(^^;<br><br>＃　GMailは日々ミリ秒単位の改善をやってるって話ですから、速度差の議論については人それぞれの見解があると思いますケド :-)</body>
<timestamp>1211016631</timestamp>
</comment>
</comments>
```


[はてなダイアリー 2008-05-16](https://nishiohirokazu.hatenadiary.org/archive/2008/05/16)