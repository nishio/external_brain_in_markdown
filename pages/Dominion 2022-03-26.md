
[nishio hirokazu(@nishio)](https://twitter.com/nishio/status/1507455004252127238)
> [[ドミガイド]]という本が良いらしいと聞いたので買ってみたのだけど本当に良い本で、問題の難易度が1〜5まである中の2で「なるほど、そうか」と唸らされている。
>
> ところで出題が山札の残りがわかってる想定なのは強い人はみんなカードカウンティングできるということなのだろうか…

前回、Coin PerCardを見るために作ったもの
- [[Dominion 2022-03-19]]
これはデッキ全体でしか扱ってなくて山札の残りとかがわからない、なので分けて管理する仕組みが必要

できた
![image](https://gyazo.com/33c3fdfeec2205236dae869f34a14219/thumb/1000)

次に何がドローされるかの予想が大事みたいなので10万回シミュレーションして頻度順に出すようにした
また、どのように変化したのかを振り返れるようにログ記録機能をつけた
- ![image](https://gyazo.com/db981d8ae40bf9c66c861103ec47eeb0/thumb/1000)
- T4、鍛冶屋をプレイして8コイン、ここは金貨だろう

鍛冶屋ステロ
途中1ターン記録し損ねてしまった、ログ記録ボタンはクリーンアップの隣に置くべきだな
:

```
銅貨7-屋敷3,10,3,0.70
鍛冶屋1-銅貨7-屋敷3,11,3,0.64
鍛冶屋1-銅貨7-銀貨1-屋敷3,12,3,0.75
鍛冶屋1-銅貨7-銀貨2-屋敷3,13,3,0.85
鍛冶屋1-銅貨7-銀貨3-金貨1-屋敷3,15,3,1.07
鍛冶屋1-銅貨7-銀貨4-金貨1-屋敷3,16,3,1.13
鍛冶屋1-銅貨7-銀貨4-金貨1-屋敷3-属州1,17,9,1.06
鍛冶屋1-銅貨7-銀貨4-金貨2-屋敷3-属州1,18,9,1.17
鍛冶屋1-銅貨7-銀貨5-金貨2-屋敷3-属州1,19,9,1.21
鍛冶屋1-銅貨7-銀貨5-金貨2-屋敷3-属州2,20,15,1.15
鍛冶屋1-銅貨7-銀貨5-金貨3-屋敷3-属州2,21,15,1.24
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷3-属州2,22,15,1.32
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷3-属州3,23,21,1.26
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷3-公領1-属州3,24,24,1.21
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷3-公領2-属州3,25,27,1.16
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷3-公領2-属州4,26,33,1.12
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷3-公領3-属州4,27,36,1.07
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷4-公領3-属州4,28,37,1.04
鍛冶屋1-銅貨7-銀貨5-金貨4-屋敷4-公領4-属州4,29,40,1.00
```


研究所引き切り
9コインだけど引き切れてなかったら研究所買うのかな
お、引き切って8コインだ、じゃあ属州を買おう
:

```
銅貨7-屋敷3,10,3,0.70
銅貨7-銀貨1-屋敷3,11,3,0.82
金貸し1-銅貨7-銀貨1-屋敷3,12,3,0.75
金貸し1-銅貨7-銀貨2-屋敷3,13,3,0.85
金貸し1-衛兵1-銅貨6-銀貨2-屋敷3,13,3,0.77
金貸し1-衛兵1-研究所1-銅貨6-銀貨2-屋敷3,14,3,0.71
金貸し1-衛兵1-研究所1-銅貨4-銀貨3-屋敷3,13,3,0.77
金貸し1-衛兵1-研究所2-銅貨4-銀貨3-屋敷3,14,3,0.71
金貸し1-衛兵1-研究所2-銅貨2-銀貨4-屋敷3,13,3,0.77
金貸し1-衛兵1-研究所3-銅貨2-銀貨4-屋敷3,14,3,0.71
金貸し1-衛兵1-研究所4-銅貨0-銀貨4-屋敷3,13,3,0.62
金貸し1-衛兵1-研究所4-銅貨0-銀貨4-屋敷3-属州1,14,9,0.57
金貸し1-衛兵1-研究所4-銅貨0-銀貨4-屋敷3-属州2,15,15,0.53
金貸し0-衛兵1-研究所4-銅貨0-銀貨4-屋敷2-属州3,14,20,0.57
金貸し0-衛兵1-研究所5-銅貨0-銀貨4-屋敷2-属州3,15,20,0.53
金貸し0-衛兵1-研究所5-銅貨0-銀貨4-屋敷1-属州4,15,25,0.53
金貸し0-衛兵1-研究所5-銅貨0-銀貨4-屋敷1-属州5,16,31,0.50
金貸し0-衛兵1-研究所5-銅貨0-銀貨4-屋敷1-属州6,17,37,0.47
金貸し0-衛兵1-研究所5-銅貨0-銀貨4-屋敷1-公領1-属州6,18,40,0.44
```


衛兵の効果で銀貨を見た後戻すのが今のUIだと大変だ
- ドローして手札に入った銀貨をプレイしてから破棄して、別途銀貨を獲得して捨て札に入ったのをデッキに戻して、本当はトップデッキなのにわからないから次のドローのシミュレーションがうまくいかなくて手でドローすることになる
- 手札からデッキトップに戻すボタンをつけるか
- もしくはデッキタップを一時的に見るカードは多いから今のランダムドローボタンの隣に「手札ではないところに置く」ボタンをつけて、そのゾーンのカードには「破棄、捨て札、デッキトップに戻す」の3つのボタンを出すか。

![image](https://gyazo.com/cd66fa8098b0236b28b7e47c426ee945/thumb/1000)
- 本当は一つの散布図に合体したかったんだけどGoogle Spreadsheetでやる方法がわからなかったので縮尺を大体合わせて並べておいた
- 横軸がカードの枚数、縦軸が平均金量coin per card
- 左の鍛冶屋ステロではカード枚数を単調に増やしながら金量を1.3ぐらいまで増やし、その後勝利点が入るにつれて下がっていっている
- 右の研究所引き切りでは0.75前後を上下してから下がっていってる
- 工房で村鍛冶屋引き切りするなら鍛冶屋ステロよりもっと早く枚数が増えるだろう
- 礼拝堂ステロなら一旦枚数が減ってから速いペースで金量が増え、勝利点を買うと早いペースで減るだろう

> 礼拝堂-銅貨-銅貨-銀貨-屋敷: 29%
これって銀貨残すのでいいんだっけ？？

> 礼拝堂-銀貨-銀貨-銀貨-銀貨: 75%
6枚の礼拝堂と銀貨だけのデッキで必然的にこうなるけど金貨と属州のどちらが正解か

あ、操作を間違えたような気がする(7コインで属州買ったかも？とかの)時に確認する方法も戻してやり直す方法もないから最初からやり直しになっちゃうな
ログをスプレッドシートにコピペしやすいようにCSV形式で画面に出してるけど、JSONで取ってるので十分な情報を入れてUndoボタンとかをつけだ方がいいな

できた
![image](https://gyazo.com/553467cecca0181455816d71447e7267/thumb/1000)
:

```
礼拝堂1-銅貨7-屋敷3,11,3,0.64
礼拝堂1-銅貨7-銀貨1-屋敷3,12,3,0.75
礼拝堂1-銅貨7-銀貨2-屋敷3,13,3,0.85
礼拝堂1-銅貨5-銀貨2-屋敷2,10,2,0.90
礼拝堂1-銅貨5-銀貨3-屋敷2,11,2,1.00
礼拝堂1-銅貨3-銀貨3-屋敷1,8,1,1.13
礼拝堂1-銅貨3-銀貨3-金貨1-屋敷1,9,1,1.33
礼拝堂1-銅貨1-銀貨4-金貨1-屋敷1,8,1,1.50
礼拝堂1-銅貨1-銀貨4-金貨1-屋敷1-属州1,9,7,1.33
礼拝堂1-銀貨4-金貨1-屋敷1-属州1,8,7,1.38
礼拝堂1-銀貨4-金貨2-屋敷1-属州1,9,7,1.56
礼拝堂1-銀貨4-金貨2-屋敷1-属州2,10,13,1.40
礼拝堂1-銀貨4-金貨3-屋敷1-属州2,11,13,1.55
礼拝堂1-銀貨4-金貨4-屋敷1-属州2,12,13,1.67
礼拝堂1-銀貨4-金貨4-屋敷1-属州3,13,19,1.54
礼拝堂1-銀貨5-金貨4-属州3,13,18,1.69
礼拝堂1-銀貨5-金貨4-属州4,14,24,1.57
礼拝堂1-銀貨5-金貨4-公領1-属州4,15,27,1.47
礼拝堂1-銀貨5-金貨4-公領2-属州5,17,36,1.29
礼拝堂1-銀貨5-金貨4-公領3-属州5,18,39,1.22
礼拝堂1-銀貨5-金貨4-公領4-属州5,19,42,1.16
礼拝堂1-銀貨5-金貨4-公領5-属州5,20,45,1.10
```


![image](https://gyazo.com/df623f503ac930a4ad9c1675dd83165d/thumb/1000)

[https://twitter.com/nishio/status/1507790327390048257?s=21](https://twitter.com/nishio/status/1507790327390048257?s=21)

