---
title: "マイナ認証したい"
---

[[マイナンバー認証]]を現代のモダンな方法で扱うにはどうしたらいい?<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>

<img src='https://scrapbox.io/api/pages/nishio/GPT5/icon' alt='GPT5.icon' height="19.5"/>
端的に言うと、「[[JPKI]]（マイナンバーカードの電子証明書）を、[[OIDC]]で“普通の[[IDプロバイダ]]”として扱う」のが今の正解です。スマホ搭載の電子証明書を前提にして [[Passkey]] 等の普段ログインと“段階的に”組み合わせます。
- ID基盤は OIDC（Auth Code + PKCE）
    - デジタル庁の「デジタル認証アプリ」はOP（OpenID Provider）として動作する

自前実装は最小限にしたい<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>

<img src='https://scrapbox.io/api/pages/nishio/GPT5/icon' alt='GPT5.icon' height="19.5"/>
「自前は最小」に振るなら、[[IdPブローカー]]を使って外部OP（JPKI/マイナ）とフェデレーションするのが一番ラクです。アプリ側は標準ライブラリだけ。
おすすめ構成（運用ラク順）
- [[マネージドIdP]]（[[Auth0]] / [[Okta]] / [[Azure AD B2C]] / [[Cognito]]）
    - そこに「外部 OIDC IdP」としてデジタル庁のOP（=マイナ認証）を登録。
    - パスキーや通常ログインはマネージドIdP側で、ステップアップ時だけ JPKI にリダイレクト。

個人でVercelでマイナ認証可能な実験プロジェクトを作ろうと思っている、どうするのが楽？<img src='https://scrapbox.io/api/pages/nishio/nishio/icon' alt='nishio.icon' height="19.5"/>
<img src='https://scrapbox.io/api/pages/nishio/GPT5/icon' alt='GPT5.icon' height="19.5"/>
- 申請ナシですぐ遊ぶ → [[PocketSign]]のサンドボックス
    - メール登録だけで即日サンドボックスが使えます。実データなしでJPKIフローを疑似体験でき、SDK/RESTで組み込み可。
- 本番仕様に近い形で試す → デジタル庁「デジタル認証アプリ」サンドボックス
    - 公式OP（OIDC）が提供されており、/authorize /token /userinfo /jwksなどを備えます。
    - Sandbox用エンドポイントが公開（sb-auth-and-sign.go.jp）。フローはAuth Code + PKCEのみ、tokenは private_key_jwt認証です。
    - テストカード代替機能で、カードなしでもレスポンスを擬似生成して一通り確認できます（認証API利用者向け）。
    - ただし事前申請が必要（クライアント登録・鍵提出など）。IDトークン署名はES256。

> 3.2. プラットフォーム事業者になるための手続き
>  PF事業者としてサービス導入する場合、まずは[[J-LIS]]から技術仕様等を入手のうえ、主務大臣認定手続きを進める必要があります。認定取得後には、署名検証等のためのシステム環境を整備する必要があります。
>  なお、技術仕様等の入手から主務大臣認定取得までには6か月から1年程度を要します。手続きの全体像は、以下総務省、デジタル庁が公表するガイドラインをご参照ください。
[https://www.digital.go.jp/policies/mynumber/private-business/jpki-introduction#guidance3.2](https://www.digital.go.jp/policies/mynumber/private-business/jpki-introduction#guidance3.2)

> 3.3. 公的個人認証サービス利用料
> 公的個人認証サービスの利用においては、一般的な国の許認可事業とは異なり、主務大臣認定の取得や維持等に係る費用は発生しません。J-LISに対する電子証明書検証手数料のみが必要となります。
> 公的個人認証サービス利用料は、有効性確認の件数に応じた従量課金制であり、署名用電子証明書の場合20円/1件、利用者証明用電子証明書の場合2円/1件とされています。
> なお、これら利用料は2023年1月より当面無料となります※8。PF事業者のサービス利用コストを引き下げ、サービス導入を後押しすることが狙いです。詳細は、以下をご参照ください。

大変...
